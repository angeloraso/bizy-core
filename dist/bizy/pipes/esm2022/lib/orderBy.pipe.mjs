import { Pipe } from '@angular/core';
import * as i0 from "@angular/core";
export class BizyOrderByPipe {
    transform(items, order = 'asc', property = '', turnOff = false) {
        if (turnOff) {
            return items;
        }
        // No items
        if (!items) {
            return [];
        }
        // Array with only one item
        if (items.length <= 1) {
            return items;
        }
        let output = [...items];
        if (property === '') {
            if (order === 'asc') {
                output.sort();
                return output;
            }
            output.sort().reverse();
            return output;
        }
        const isDate = (value) => {
            const ddMMYYYYhhmmss = /^\d{1,2}\/\d{1,2}\/\d{4}( \d{1,2}:\d{1,2}(:\d{1,2})?)?$/;
            return ddMMYYYYhhmmss.test(value);
        };
        const parseDateString = (value) => {
            const [datePart, timePart] = value.split(' ');
            const separator = value.includes('/') ? '/' : '-';
            const [day, month, year] = datePart.split(separator).map(Number);
            let hours = 0, minutes = 0, seconds = 0;
            if (timePart) {
                const [hourStr, minuteStr, secondStr] = timePart.split(':').map(Number);
                hours = isNaN(hourStr) ? 0 : hourStr;
                minutes = isNaN(minuteStr) ? 0 : minuteStr;
                seconds = isNaN(secondStr) ? 0 : secondStr;
            }
            return new Date(year, month - 1, day, hours, minutes, seconds);
        };
        const getValue = (item) => {
            let value = item;
            const nestedProperty = property.split('.');
            nestedProperty.forEach(_property => {
                if (_property) {
                    value = value[_property];
                }
            });
            return value;
        };
        const index = output.findIndex(_item => {
            const value = getValue(_item);
            return typeof value !== 'undefined' && value !== null;
        });
        if (index === -1) {
            return output;
        }
        const value = getValue(output[index]);
        if (!isNaN(value)) {
            if (order === 'asc') {
                output = output.sort((a, b) => Number(getValue(a)) - Number(getValue(b)));
            }
            else {
                output = output.sort((a, b) => Number(getValue(b)) - Number(getValue(a)));
            }
            return output;
        }
        else if (isDate(value)) {
            output = output.sort((a, b) => {
                const aDate = parseDateString(getValue(a));
                const bDate = parseDateString(getValue(b));
                return order === 'asc' ? aDate.getTime() - bDate.getTime() : bDate.getTime() - aDate.getTime();
            });
            return output;
        }
        else {
            output.sort((a, b) => {
                let aValue = a;
                let bValue = b;
                const nestedProperty = property.split('.');
                nestedProperty.forEach(_property => {
                    aValue = aValue[_property];
                    bValue = bValue[_property];
                });
                if ((typeof aValue === 'undefined' || aValue === null) && (typeof bValue === 'undefined' || bValue === null)) {
                    return 0;
                }
                if ((typeof aValue === 'undefined' || aValue === null) && (typeof bValue !== 'undefined' && bValue !== null)) {
                    return order === 'desc' ? 1 : -1;
                }
                if ((typeof aValue !== 'undefined' && aValue !== null) && (typeof bValue === 'undefined' || bValue === null)) {
                    return order === 'desc' ? -1 : 1;
                }
                if (aValue === bValue) {
                    return 0;
                }
                if (order === 'desc') {
                    return (aValue.toString().toLowerCase() > bValue.toString().toLowerCase() ? -1 : 1);
                }
                return (bValue.toString().toLowerCase() > aValue.toString().toLowerCase() ? -1 : 1);
            });
            return output;
        }
    }
    static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: BizyOrderByPipe, deps: [], target: i0.ɵɵFactoryTarget.Pipe });
    static ɵpipe = i0.ɵɵngDeclarePipe({ minVersion: "14.0.0", version: "16.2.12", ngImport: i0, type: BizyOrderByPipe, name: "bizyOrderBy" });
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: BizyOrderByPipe, decorators: [{
            type: Pipe,
            args: [{
                    name: 'bizyOrderBy'
                }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3JkZXJCeS5waXBlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvcGlwZXMvc3JjL2xpYi9vcmRlckJ5LnBpcGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLElBQUksRUFBaUIsTUFBTSxlQUFlLENBQUM7O0FBS3BELE1BQU0sT0FBTyxlQUFlO0lBQzFCLFNBQVMsQ0FBSSxLQUFlLEVBQUUsUUFBd0IsS0FBSyxFQUFFLFdBQW1CLEVBQUUsRUFBRSxVQUFtQixLQUFLO1FBQzFHLElBQUksT0FBTyxFQUFFO1lBQ1gsT0FBTyxLQUFLLENBQUM7U0FDZDtRQUVELFdBQVc7UUFDWCxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ1YsT0FBTyxFQUFFLENBQUM7U0FDWDtRQUVELDJCQUEyQjtRQUMzQixJQUFJLEtBQUssQ0FBQyxNQUFNLElBQUksQ0FBQyxFQUFFO1lBQ3JCLE9BQU8sS0FBSyxDQUFDO1NBQ2Q7UUFFRCxJQUFJLE1BQU0sR0FBYSxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUM7UUFFbEMsSUFBSSxRQUFRLEtBQUssRUFBRSxFQUFFO1lBQ25CLElBQUksS0FBSyxLQUFLLEtBQUssRUFBRTtnQkFDbkIsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDO2dCQUNkLE9BQU8sTUFBTSxDQUFDO2FBQ2Y7WUFFRCxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDeEIsT0FBTyxNQUFNLENBQUM7U0FDZjtRQUVELE1BQU0sTUFBTSxHQUFHLENBQUMsS0FBYSxFQUFFLEVBQUU7WUFDL0IsTUFBTSxjQUFjLEdBQUkseURBQXlELENBQUM7WUFDbEYsT0FBTyxjQUFjLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3BDLENBQUMsQ0FBQTtRQUVELE1BQU0sZUFBZSxHQUFHLENBQUMsS0FBYSxFQUFFLEVBQUU7WUFDeEMsTUFBTSxDQUFDLFFBQVEsRUFBRSxR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QUFDO3dHQTFIVSxlQUFlO3NHQUFmLGVBQWU7OzRGQUFmLGVBQWU7a0JBSDNCLElBQUk7bUJBQUM7b0JBQ0osSUFBSSxFQUFFLGFBQWE7aUJBQ3BCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGlwZSwgUGlwZVRyYW5zZm9ybSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5AUGlwZSh7XG4gIG5hbWU6ICdiaXp5T3JkZXJCeSdcbn0pXG5leHBvcnQgY2xhc3MgQml6eU9yZGVyQnlQaXBlIGltcGxlbWVudHMgUGlwZVRyYW5zZm9ybSB7XG4gIHRyYW5zZm9ybTxUPihpdGVtczogQXJyYXk8VD4sIG9yZGVyOiAnYXNjJyB8ICdkZXNjJyA9ICdhc2MnLCBwcm9wZXJ0eTogc3RyaW5nID0gJycsIHR1cm5PZmY6IGJvb2xlYW4gPSBmYWxzZSk6IEFycmF5PFQ+IHtcbiAgICBpZiAodHVybk9mZikge1xuICAgICAgcmV0dXJuIGl0ZW1zO1xuICAgIH1cblxuICAgIC8vIE5vIGl0ZW1zXG4gICAgaWYgKCFpdGVtcykge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIC8vIEFycmF5IHdpdGggb25seSBvbmUgaXRlbVxuICAgIGlmIChpdGVtcy5sZW5ndGggPD0gMSkge1xuICAgICAgcmV0dXJuIGl0ZW1zO1xuICAgIH1cblxuICAgIGxldCBvdXRwdXQ6IEFycmF5PFQ+ID0gWy4uLml0ZW1zXTtcblxuICAgIGlmIChwcm9wZXJ0eSA9PT0gJycpIHtcbiAgICAgIGlmIChvcmRlciA9PT0gJ2FzYycpIHtcbiAgICAgICAgb3V0cHV0LnNvcnQoKTtcbiAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICAgIH1cblxuICAgICAgb3V0cHV0LnNvcnQoKS5yZXZlcnNlKCk7XG4gICAgICByZXR1cm4gb3V0cHV0O1xuICAgIH1cblxuICAgIGNvbnN0IGlzRGF0ZSA9ICh2YWx1ZTogc3RyaW5nKSA9PiB7XG4gICAgICBjb25zdCBkZE1NWVlZWWhobW1zcyA9ICAvXlxcZHsxLDJ9XFwvXFxkezEsMn1cXC9cXGR7NH0oIFxcZHsxLDJ9OlxcZHsxLDJ9KDpcXGR7MSwyfSk/KT8kLztcbiAgICAgIHJldHVybiBkZE1NWVlZWWhobW1zcy50ZXN0KHZhbHVlKTtcbiAgICB9XG4gIFxuICAgIGNvbnN0IHBhcnNlRGF0ZVN0cmluZyA9ICh2YWx1ZTogc3RyaW5nKSA9PiB7XG4gICAgICBjb25zdCBbZGF0ZVBhcnQsIHRpbWVQYXJ0XSA9IHZhbHVlLnNwbGl0KCcgJyk7XG4gICAgICBjb25zdCBzZXBhcmF0b3IgPSB2YWx1ZS5pbmNsdWRlcygnLycpID8gJy8nIDogJy0nO1xuICBcbiAgICAgIGNvbnN0IFtkYXksIG1vbnRoLCB5ZWFyXSA9IGRhdGVQYXJ0LnNwbGl0KHNlcGFyYXRvcikubWFwKE51bWJlcik7XG4gIFxuICAgICAgbGV0IGhvdXJzID0gMCwgbWludXRlcyA9IDAsIHNlY29uZHMgPSAwO1xuICBcbiAgICAgIGlmICh0aW1lUGFydCkge1xuICAgICAgICAgIGNvbnN0IFtob3VyU3RyLCBtaW51dGVTdHIsIHNlY29uZFN0cl0gPSB0aW1lUGFydC5zcGxpdCgnOicpLm1hcChOdW1iZXIpO1xuICAgICAgICAgIGhvdXJzID0gaXNOYU4oaG91clN0cikgPyAwIDogaG91clN0cjtcbiAgICAgICAgICBtaW51dGVzID0gaXNOYU4obWludXRlU3RyKSA/IDAgOiBtaW51dGVTdHI7XG4gICAgICAgICAgc2Vjb25kcyA9IGlzTmFOKHNlY29uZFN0cikgPyAwIDogc2Vjb25kU3RyO1xuICAgICAgfVxuICBcbiAgICAgIHJldHVybiBuZXcgRGF0ZSh5ZWFyLCBtb250aCAtIDEsIGRheSwgaG91cnMsIG1pbnV0ZXMsIHNlY29uZHMpO1xuICAgIH1cblxuICAgIGNvbnN0IGdldFZhbHVlID0gKGl0ZW06IFQpID0+IHtcbiAgICAgIGxldCB2YWx1ZSA9IGl0ZW07XG4gICAgICBjb25zdCBuZXN0ZWRQcm9wZXJ0eSA9IHByb3BlcnR5LnNwbGl0KCcuJyk7XG4gICAgICBuZXN0ZWRQcm9wZXJ0eS5mb3JFYWNoKF9wcm9wZXJ0eSA9PiB7XG4gICAgICAgIGlmIChfcHJvcGVydHkpIHtcbiAgICAgICAgICB2YWx1ZSA9IHZhbHVlW19wcm9wZXJ0eV07XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuXG4gICAgY29uc3QgaW5kZXggPSBvdXRwdXQuZmluZEluZGV4KF9pdGVtID0+IHtcbiAgICAgIGNvbnN0IHZhbHVlID0gZ2V0VmFsdWUoX2l0ZW0pO1xuICAgICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgIT09IG51bGw7XG4gICAgfSk7XG5cbiAgICBpZiAoaW5kZXggPT09IC0xKSB7XG4gICAgICByZXR1cm4gb3V0cHV0O1xuICAgIH1cblxuXG4gICAgY29uc3QgdmFsdWUgPSBnZXRWYWx1ZShvdXRwdXRbaW5kZXhdKTtcbiAgICBpZiAoIWlzTmFOKHZhbHVlIGFzIG51bWJlcikpIHtcbiAgICAgIGlmIChvcmRlciA9PT0gJ2FzYycpIHtcbiAgICAgICAgb3V0cHV0ID0gb3V0cHV0LnNvcnQoKGEsIGIpID0+IE51bWJlcihnZXRWYWx1ZShhKSkgLSBOdW1iZXIoZ2V0VmFsdWUoYikpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG91dHB1dCA9IG91dHB1dC5zb3J0KChhLCBiKSA9PiBOdW1iZXIoZ2V0VmFsdWUoYikpIC0gTnVtYmVyKGdldFZhbHVlKGEpKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gb3V0cHV0O1xuICAgIH0gZWxzZSBpZiAoaXNEYXRlKHZhbHVlIGFzIHN0cmluZykpIHtcbiAgICAgIG91dHB1dCA9IG91dHB1dC5zb3J0KChhLCBiKSA9PiAge1xuICAgICAgICBjb25zdCBhRGF0ZSA9IHBhcnNlRGF0ZVN0cmluZyhnZXRWYWx1ZShhKSBhcyBzdHJpbmcpXG4gICAgICAgIGNvbnN0IGJEYXRlID0gcGFyc2VEYXRlU3RyaW5nKGdldFZhbHVlKGIpIGFzIHN0cmluZylcbiAgICAgICAgcmV0dXJuIG9yZGVyID09PSAnYXNjJyA/IGFEYXRlLmdldFRpbWUoKSAtICBiRGF0ZS5nZXRUaW1lKCkgOiBiRGF0ZS5nZXRUaW1lKCkgLSAgYURhdGUuZ2V0VGltZSgpXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIG91dHB1dC5zb3J0KChhOiBhbnksIGI6IGFueSkgPT4ge1xuICAgICAgICBsZXQgYVZhbHVlOiBhbnkgPSBhO1xuICAgICAgICBsZXQgYlZhbHVlOiBhbnkgPSBiO1xuICAgICAgICBjb25zdCBuZXN0ZWRQcm9wZXJ0eSA9IHByb3BlcnR5LnNwbGl0KCcuJyk7XG4gICAgICAgIG5lc3RlZFByb3BlcnR5LmZvckVhY2goX3Byb3BlcnR5ID0+IHtcbiAgICAgICAgICBhVmFsdWUgPSBhVmFsdWVbX3Byb3BlcnR5XTtcbiAgICAgICAgICBiVmFsdWUgPSBiVmFsdWVbX3Byb3BlcnR5XTtcbiAgICAgICAgfSk7XG4gIFxuICAgICAgICBpZiAoKHR5cGVvZiBhVmFsdWUgPT09ICd1bmRlZmluZWQnIHx8IGFWYWx1ZSA9PT0gbnVsbCkgJiYgKHR5cGVvZiBiVmFsdWUgPT09ICd1bmRlZmluZWQnIHx8IGJWYWx1ZSA9PT0gbnVsbCkpIHtcbiAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICBcbiAgICAgICAgaWYgKCh0eXBlb2YgYVZhbHVlID09PSAndW5kZWZpbmVkJyB8fCBhVmFsdWUgPT09IG51bGwpICYmICh0eXBlb2YgYlZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiBiVmFsdWUgIT09IG51bGwpKSB7XG4gICAgICAgICAgcmV0dXJuIG9yZGVyID09PSAnZGVzYycgPyAxIDogLTE7XG4gICAgICAgIH1cbiAgXG4gICAgICAgIGlmICgodHlwZW9mIGFWYWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgYVZhbHVlICE9PSBudWxsKSAmJiAodHlwZW9mIGJWYWx1ZSA9PT0gJ3VuZGVmaW5lZCcgfHwgYlZhbHVlID09PSBudWxsKSApIHtcbiAgICAgICAgICByZXR1cm4gb3JkZXIgPT09ICdkZXNjJyA/IC0xIDogMTtcbiAgICAgICAgfVxuICBcbiAgICAgICAgaWYgKGFWYWx1ZSA9PT0gYlZhbHVlKSB7XG4gICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgXG4gICAgICAgIGlmIChvcmRlciA9PT0gJ2Rlc2MnKSB7XG4gICAgICAgICAgcmV0dXJuIChhVmFsdWUudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpID4gYlZhbHVlLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKSA/IC0xIDogMSk7XG4gICAgICAgIH1cbiAgXG4gICAgICAgIHJldHVybiAoYlZhbHVlLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKSA+IGFWYWx1ZS50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkgPyAtMSA6IDEpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gb3V0cHV0O1xuICAgIH1cbiAgfVxufVxuIl19