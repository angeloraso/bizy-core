import { Pipe } from '@angular/core';
import * as i0 from "@angular/core";
export class BizyOrderByPipe {
    transform(items, order = null, property = '', turnOff = false) {
        if (turnOff) {
            return items;
        }
        // No items
        if (!items) {
            return [];
        }
        if (!order) {
            return items;
        }
        // Array with only one item
        if (items.length <= 1) {
            return items;
        }
        let output = [...items];
        if (property === '') {
            if (order === 'asc') {
                output.sort();
                return output;
            }
            output.sort().reverse();
            return output;
        }
        const isDate = (value) => {
            const ddMMYYYYhhmmss = /^\d{1,2}\/\d{1,2}\/\d{4}( \d{1,2}:\d{1,2}(:\d{1,2})?)?$/;
            return ddMMYYYYhhmmss.test(value);
        };
        const parseDateString = (value) => {
            const [datePart, timePart] = value.split(' ');
            const separator = value.includes('/') ? '/' : '-';
            const [day, month, year] = datePart.split(separator).map(Number);
            let hours = 0, minutes = 0, seconds = 0;
            if (timePart) {
                const [hourStr, minuteStr, secondStr] = timePart.split(':').map(Number);
                hours = isNaN(hourStr) ? 0 : hourStr;
                minutes = isNaN(minuteStr) ? 0 : minuteStr;
                seconds = isNaN(secondStr) ? 0 : secondStr;
            }
            return new Date(year, month - 1, day, hours, minutes, seconds);
        };
        const getValue = (item) => {
            let value = item;
            const nestedProperty = property.split('.');
            nestedProperty.forEach(_property => {
                if (_property && value[_property]) {
                    value = value[_property];
                }
            });
            return value || null;
        };
        const index = output.findIndex(_item => {
            const value = getValue(_item);
            return typeof value !== 'undefined' && value !== null;
        });
        if (index === -1) {
            return output;
        }
        const value = getValue(output[index]);
        if (!isNaN(value)) {
            if (order === 'asc') {
                output = output.sort((a, b) => Number(getValue(a)) - Number(getValue(b)));
            }
            else {
                output = output.sort((a, b) => Number(getValue(b)) - Number(getValue(a)));
            }
            return output;
        }
        else if (isDate(value)) {
            output = output.sort((a, b) => {
                const aDate = parseDateString(getValue(a));
                const bDate = parseDateString(getValue(b));
                return order === 'asc' ? aDate.getTime() - bDate.getTime() : bDate.getTime() - aDate.getTime();
            });
            return output;
        }
        else {
            output.sort((a, b) => {
                let aValue = a;
                let bValue = b;
                const nestedProperty = property.split('.');
                nestedProperty.forEach(_property => {
                    aValue = aValue[_property];
                    bValue = bValue[_property];
                });
                if ((typeof aValue === 'undefined' || aValue === null) && (typeof bValue === 'undefined' || bValue === null)) {
                    return 0;
                }
                if ((typeof aValue === 'undefined' || aValue === null) && (typeof bValue !== 'undefined' && bValue !== null)) {
                    return order === 'desc' ? 1 : -1;
                }
                if ((typeof aValue !== 'undefined' && aValue !== null) && (typeof bValue === 'undefined' || bValue === null)) {
                    return order === 'desc' ? -1 : 1;
                }
                if (aValue === bValue) {
                    return 0;
                }
                if (order === 'desc') {
                    return (aValue.toString().toLowerCase() > bValue.toString().toLowerCase() ? -1 : 1);
                }
                return (bValue.toString().toLowerCase() > aValue.toString().toLowerCase() ? -1 : 1);
            });
            return output;
        }
    }
    static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: BizyOrderByPipe, deps: [], target: i0.ɵɵFactoryTarget.Pipe });
    static ɵpipe = i0.ɵɵngDeclarePipe({ minVersion: "14.0.0", version: "16.2.12", ngImport: i0, type: BizyOrderByPipe, name: "bizyOrderBy" });
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: BizyOrderByPipe, decorators: [{
            type: Pipe,
            args: [{
                    name: 'bizyOrderBy'
                }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3JkZXJCeS5waXBlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvcGlwZXMvc3JjL2xpYi9vcmRlckJ5LnBpcGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLElBQUksRUFBaUIsTUFBTSxlQUFlLENBQUM7O0FBS3BELE1BQU0sT0FBTyxlQUFlO0lBQzFCLFNBQVMsQ0FBSSxLQUFlLEVBQUUsUUFBK0IsSUFBSSxFQUFFLFdBQW1CLEVBQUUsRUFBRSxVQUFtQixLQUFLO1FBQ2hILElBQUksT0FBTyxFQUFFO1lBQ1gsT0FBTyxLQUFLLENBQUM7U0FDZDtRQUVELFdBQVc7UUFDWCxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ1YsT0FBTyxFQUFFLENBQUM7U0FDWDtRQUVELElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDVixPQUFPLEtBQUssQ0FBQztTQUNkO1FBRUQsMkJBQTJCO1FBQzNCLElBQUksS0FBSyxDQUFDLE1BQU0sSUFBSSxDQUFDLEVBQUU7WUFDckIsT0FBTyxLQUFLLENBQUM7U0FDZDtRQUVELElBQUksTUFBTSxHQUFhLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQztRQUVsQyxJQUFJLFFBQVEsS0FBSyxFQUFFLEVBQUU7WUFDbkIsSUFBSSxLQUFLLEtBQUssS0FBSyxFQUFFO2dCQUNuQixNQUFNLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBQ2QsT0FBTyxNQUFNLENBQUM7YUFDZjtZQUVELE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUN4QixPQUFPLE1BQU0sQ0FBQztTQUNmO1FBRUQsTUFBTSxNQUFNLEdBQUcsQ0FBQyxLQUFhLEVBQUUsRUFBRTtZQUMvQixNQUFNLGNBQWMsR0FBSSx5REFBeUQsQ0FBQztZQUNsRixPQUFPLGNBQWMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDcEMsQ0FBQyxDQUFBO1FBRUQsTUFBTSxlQUFlLEdB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Q0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN0RixDQUFDLENBQUMsQ0FBQztZQUNILE9BQU8sTUFBTSxDQUFDO1NBQ2Y7SUFDSCxDQUFDO3dHQTlIVSxlQUFlO3NHQUFmLGVBQWU7OzRGQUFmLGVBQWU7a0JBSDNCLElBQUk7bUJBQUM7b0JBQ0osSUFBSSxFQUFFLGFBQWE7aUJBQ3BCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGlwZSwgUGlwZVRyYW5zZm9ybSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5AUGlwZSh7XG4gIG5hbWU6ICdiaXp5T3JkZXJCeSdcbn0pXG5leHBvcnQgY2xhc3MgQml6eU9yZGVyQnlQaXBlIGltcGxlbWVudHMgUGlwZVRyYW5zZm9ybSB7XG4gIHRyYW5zZm9ybTxUPihpdGVtczogQXJyYXk8VD4sIG9yZGVyOiAnYXNjJyB8ICdkZXNjJyB8IG51bGwgPSBudWxsLCBwcm9wZXJ0eTogc3RyaW5nID0gJycsIHR1cm5PZmY6IGJvb2xlYW4gPSBmYWxzZSk6IEFycmF5PFQ+IHtcbiAgICBpZiAodHVybk9mZikge1xuICAgICAgcmV0dXJuIGl0ZW1zO1xuICAgIH1cblxuICAgIC8vIE5vIGl0ZW1zXG4gICAgaWYgKCFpdGVtcykge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIGlmICghb3JkZXIpIHtcbiAgICAgIHJldHVybiBpdGVtcztcbiAgICB9XG5cbiAgICAvLyBBcnJheSB3aXRoIG9ubHkgb25lIGl0ZW1cbiAgICBpZiAoaXRlbXMubGVuZ3RoIDw9IDEpIHtcbiAgICAgIHJldHVybiBpdGVtcztcbiAgICB9XG5cbiAgICBsZXQgb3V0cHV0OiBBcnJheTxUPiA9IFsuLi5pdGVtc107XG5cbiAgICBpZiAocHJvcGVydHkgPT09ICcnKSB7XG4gICAgICBpZiAob3JkZXIgPT09ICdhc2MnKSB7XG4gICAgICAgIG91dHB1dC5zb3J0KCk7XG4gICAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgICB9XG5cbiAgICAgIG91dHB1dC5zb3J0KCkucmV2ZXJzZSgpO1xuICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICB9XG5cbiAgICBjb25zdCBpc0RhdGUgPSAodmFsdWU6IHN0cmluZykgPT4ge1xuICAgICAgY29uc3QgZGRNTVlZWVloaG1tc3MgPSAgL15cXGR7MSwyfVxcL1xcZHsxLDJ9XFwvXFxkezR9KCBcXGR7MSwyfTpcXGR7MSwyfSg6XFxkezEsMn0pPyk/JC87XG4gICAgICByZXR1cm4gZGRNTVlZWVloaG1tc3MudGVzdCh2YWx1ZSk7XG4gICAgfVxuICBcbiAgICBjb25zdCBwYXJzZURhdGVTdHJpbmcgPSAodmFsdWU6IHN0cmluZykgPT4ge1xuICAgICAgY29uc3QgW2RhdGVQYXJ0LCB0aW1lUGFydF0gPSB2YWx1ZS5zcGxpdCgnICcpO1xuICAgICAgY29uc3Qgc2VwYXJhdG9yID0gdmFsdWUuaW5jbHVkZXMoJy8nKSA/ICcvJyA6ICctJztcbiAgXG4gICAgICBjb25zdCBbZGF5LCBtb250aCwgeWVhcl0gPSBkYXRlUGFydC5zcGxpdChzZXBhcmF0b3IpLm1hcChOdW1iZXIpO1xuICBcbiAgICAgIGxldCBob3VycyA9IDAsIG1pbnV0ZXMgPSAwLCBzZWNvbmRzID0gMDtcbiAgXG4gICAgICBpZiAodGltZVBhcnQpIHtcbiAgICAgICAgICBjb25zdCBbaG91clN0ciwgbWludXRlU3RyLCBzZWNvbmRTdHJdID0gdGltZVBhcnQuc3BsaXQoJzonKS5tYXAoTnVtYmVyKTtcbiAgICAgICAgICBob3VycyA9IGlzTmFOKGhvdXJTdHIpID8gMCA6IGhvdXJTdHI7XG4gICAgICAgICAgbWludXRlcyA9IGlzTmFOKG1pbnV0ZVN0cikgPyAwIDogbWludXRlU3RyO1xuICAgICAgICAgIHNlY29uZHMgPSBpc05hTihzZWNvbmRTdHIpID8gMCA6IHNlY29uZFN0cjtcbiAgICAgIH1cbiAgXG4gICAgICByZXR1cm4gbmV3IERhdGUoeWVhciwgbW9udGggLSAxLCBkYXksIGhvdXJzLCBtaW51dGVzLCBzZWNvbmRzKTtcbiAgICB9XG5cbiAgICBjb25zdCBnZXRWYWx1ZSA9IChpdGVtOiBUKSA9PiB7XG4gICAgICBsZXQgdmFsdWUgPSBpdGVtO1xuICAgICAgY29uc3QgbmVzdGVkUHJvcGVydHkgPSBwcm9wZXJ0eS5zcGxpdCgnLicpO1xuICAgICAgbmVzdGVkUHJvcGVydHkuZm9yRWFjaChfcHJvcGVydHkgPT4ge1xuICAgICAgICBpZiAoX3Byb3BlcnR5ICYmIHZhbHVlW19wcm9wZXJ0eV0pIHtcbiAgICAgICAgICB2YWx1ZSA9IHZhbHVlW19wcm9wZXJ0eV07XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gdmFsdWUgfHwgbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBpbmRleCA9IG91dHB1dC5maW5kSW5kZXgoX2l0ZW0gPT4ge1xuICAgICAgY29uc3QgdmFsdWUgPSBnZXRWYWx1ZShfaXRlbSk7XG4gICAgICByZXR1cm4gdHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiB2YWx1ZSAhPT0gbnVsbDtcbiAgICB9KTtcblxuICAgIGlmIChpbmRleCA9PT0gLTEpIHtcbiAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgfVxuXG5cbiAgICBjb25zdCB2YWx1ZSA9IGdldFZhbHVlKG91dHB1dFtpbmRleF0pO1xuICAgIGlmICghaXNOYU4odmFsdWUgYXMgbnVtYmVyKSkge1xuICAgICAgaWYgKG9yZGVyID09PSAnYXNjJykge1xuICAgICAgICBvdXRwdXQgPSBvdXRwdXQuc29ydCgoYSwgYikgPT4gTnVtYmVyKGdldFZhbHVlKGEpKSAtIE51bWJlcihnZXRWYWx1ZShiKSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb3V0cHV0ID0gb3V0cHV0LnNvcnQoKGEsIGIpID0+IE51bWJlcihnZXRWYWx1ZShiKSkgLSBOdW1iZXIoZ2V0VmFsdWUoYSkpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgfSBlbHNlIGlmIChpc0RhdGUodmFsdWUgYXMgc3RyaW5nKSkge1xuICAgICAgb3V0cHV0ID0gb3V0cHV0LnNvcnQoKGEsIGIpID0+ICB7XG4gICAgICAgIGNvbnN0IGFEYXRlID0gcGFyc2VEYXRlU3RyaW5nKGdldFZhbHVlKGEpIGFzIHN0cmluZylcbiAgICAgICAgY29uc3QgYkRhdGUgPSBwYXJzZURhdGVTdHJpbmcoZ2V0VmFsdWUoYikgYXMgc3RyaW5nKVxuICAgICAgICByZXR1cm4gb3JkZXIgPT09ICdhc2MnID8gYURhdGUuZ2V0VGltZSgpIC0gIGJEYXRlLmdldFRpbWUoKSA6IGJEYXRlLmdldFRpbWUoKSAtICBhRGF0ZS5nZXRUaW1lKClcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICB9IGVsc2Uge1xuICAgICAgb3V0cHV0LnNvcnQoKGE6IGFueSwgYjogYW55KSA9PiB7XG4gICAgICAgIGxldCBhVmFsdWU6IGFueSA9IGE7XG4gICAgICAgIGxldCBiVmFsdWU6IGFueSA9IGI7XG4gICAgICAgIGNvbnN0IG5lc3RlZFByb3BlcnR5ID0gcHJvcGVydHkuc3BsaXQoJy4nKTtcbiAgICAgICAgbmVzdGVkUHJvcGVydHkuZm9yRWFjaChfcHJvcGVydHkgPT4ge1xuICAgICAgICAgIGFWYWx1ZSA9IGFWYWx1ZVtfcHJvcGVydHldO1xuICAgICAgICAgIGJWYWx1ZSA9IGJWYWx1ZVtfcHJvcGVydHldO1xuICAgICAgICB9KTtcbiAgXG4gICAgICAgIGlmICgodHlwZW9mIGFWYWx1ZSA9PT0gJ3VuZGVmaW5lZCcgfHwgYVZhbHVlID09PSBudWxsKSAmJiAodHlwZW9mIGJWYWx1ZSA9PT0gJ3VuZGVmaW5lZCcgfHwgYlZhbHVlID09PSBudWxsKSkge1xuICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gIFxuICAgICAgICBpZiAoKHR5cGVvZiBhVmFsdWUgPT09ICd1bmRlZmluZWQnIHx8IGFWYWx1ZSA9PT0gbnVsbCkgJiYgKHR5cGVvZiBiVmFsdWUgIT09ICd1bmRlZmluZWQnICYmIGJWYWx1ZSAhPT0gbnVsbCkpIHtcbiAgICAgICAgICByZXR1cm4gb3JkZXIgPT09ICdkZXNjJyA/IDEgOiAtMTtcbiAgICAgICAgfVxuICBcbiAgICAgICAgaWYgKCh0eXBlb2YgYVZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiBhVmFsdWUgIT09IG51bGwpICYmICh0eXBlb2YgYlZhbHVlID09PSAndW5kZWZpbmVkJyB8fCBiVmFsdWUgPT09IG51bGwpICkge1xuICAgICAgICAgIHJldHVybiBvcmRlciA9PT0gJ2Rlc2MnID8gLTEgOiAxO1xuICAgICAgICB9XG4gIFxuICAgICAgICBpZiAoYVZhbHVlID09PSBiVmFsdWUpIHtcbiAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICBcbiAgICAgICAgaWYgKG9yZGVyID09PSAnZGVzYycpIHtcbiAgICAgICAgICByZXR1cm4gKGFWYWx1ZS50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkgPiBiVmFsdWUudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpID8gLTEgOiAxKTtcbiAgICAgICAgfVxuICBcbiAgICAgICAgcmV0dXJuIChiVmFsdWUudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpID4gYVZhbHVlLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKSA/IC0xIDogMSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgfVxuICB9XG59XG4iXX0=