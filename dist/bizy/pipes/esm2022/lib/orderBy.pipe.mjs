import { Pipe } from '@angular/core';
import * as i0 from "@angular/core";
export class BizyOrderByPipe {
    transform(items, order = null, property = '') {
        // No items
        if (!items || !order) {
            return items;
        }
        // Array with only one item
        if (items.length <= 1) {
            return items;
        }
        const sortByString = (items, order) => {
            return items.sort((a, b) => {
                let aValue = a;
                let bValue = b;
                const nestedProperty = property.split('.');
                nestedProperty.forEach(_property => {
                    aValue = aValue[_property];
                    bValue = bValue[_property];
                });
                if ((typeof aValue === 'undefined' || aValue === null) && (typeof bValue === 'undefined' || bValue === null)) {
                    return 0;
                }
                if ((typeof aValue === 'undefined' || aValue === null) && (typeof bValue !== 'undefined' && bValue !== null)) {
                    return order === 'desc' ? 1 : -1;
                }
                if ((typeof aValue !== 'undefined' && aValue !== null) && (typeof bValue === 'undefined' || bValue === null)) {
                    return order === 'desc' ? -1 : 1;
                }
                if (aValue === bValue) {
                    return 0;
                }
                if (order === 'desc') {
                    return (this.#removeAccentsAndDiacritics(String(aValue)).toLowerCase() > this.#removeAccentsAndDiacritics(String(bValue)).toLowerCase() ? -1 : 1);
                }
                return (this.#removeAccentsAndDiacritics(String(bValue)).toLowerCase() > this.#removeAccentsAndDiacritics(String(aValue)).toLowerCase() ? -1 : 1);
            });
        };
        const sortByNumber = (items, order) => {
            if (order === 'asc') {
                return items.sort((a, b) => Number(getValue(a)) - Number(getValue(b)));
            }
            else {
                return items.sort((a, b) => Number(getValue(b)) - Number(getValue(a)));
            }
        };
        const sortByDate = (items, order) => {
            return items.sort((a, b) => {
                const aDate = parseDateString(getValue(a));
                const bDate = parseDateString(getValue(b));
                return order === 'asc' ? aDate.getTime() - bDate.getTime() : bDate.getTime() - aDate.getTime();
            });
        };
        const isDate = (value) => {
            const ddMMYYYYhhmmss = /^\d{1,2}\/\d{1,2}\/\d{4}( \d{1,2}:\d{1,2}(:\d{1,2})?)?$/;
            return ddMMYYYYhhmmss.test(value);
        };
        const parseDateString = (value) => {
            const [datePart, timePart] = value.split(' ');
            const separator = value.includes('/') ? '/' : '-';
            const [day, month, year] = datePart.split(separator).map(Number);
            let hours = 0, minutes = 0, seconds = 0;
            if (timePart) {
                const [hourStr, minuteStr, secondStr] = timePart.split(':').map(Number);
                hours = isNaN(hourStr) ? 0 : hourStr;
                minutes = isNaN(minuteStr) ? 0 : minuteStr;
                seconds = isNaN(secondStr) ? 0 : secondStr;
            }
            return new Date(year, month - 1, day, hours, minutes, seconds);
        };
        const getValue = (item) => {
            let value = item;
            const nestedProperty = property.split('.');
            for (let i = 0; i < nestedProperty.length; i++) {
                const property = nestedProperty[i];
                if (!property || typeof value[property] === 'undefined' || value[property] === null) {
                    value = null;
                    break;
                }
                value = value[property];
            }
            return value;
        };
        let output = [...items];
        if (property === '') {
            if (typeof output[0] === 'number' && !isNaN(output[0])) {
                return sortByNumber(output, order);
            }
            else if (isDate(output[0])) {
                return sortByDate(output, order);
            }
            else {
                return sortByString(output, order);
            }
        }
        const index = output.findIndex(_item => {
            const value = getValue(_item);
            return typeof value !== 'undefined' && value !== null;
        });
        if (index === -1) {
            return output;
        }
        const value = getValue(output[index]);
        if (typeof value === 'number' && !isNaN(value)) {
            return sortByNumber(output, order);
        }
        else if (isDate(value)) {
            return sortByDate(output, order);
        }
        else {
            return sortByString(output, order);
        }
    }
    #removeAccentsAndDiacritics(search) {
        if (!search) {
            return '';
        }
        return search.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
    }
    static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: BizyOrderByPipe, deps: [], target: i0.ɵɵFactoryTarget.Pipe });
    static ɵpipe = i0.ɵɵngDeclarePipe({ minVersion: "14.0.0", version: "16.2.12", ngImport: i0, type: BizyOrderByPipe, name: "bizyOrderBy" });
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: BizyOrderByPipe, decorators: [{
            type: Pipe,
            args: [{
                    name: 'bizyOrderBy'
                }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3JkZXJCeS5waXBlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvcGlwZXMvc3JjL2xpYi9vcmRlckJ5LnBpcGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLElBQUksRUFBaUIsTUFBTSxlQUFlLENBQUM7O0FBS3BELE1BQU0sT0FBTyxlQUFlO0lBQzFCLFNBQVMsQ0FBSSxLQUFlLEVBQUUsUUFBK0IsSUFBSSxFQUFFLFdBQW1CLEVBQUU7UUFDdEYsV0FBVztRQUNYLElBQUksQ0FBQyxLQUFLLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDcEIsT0FBTyxLQUFLLENBQUM7U0FDZDtRQUVELDJCQUEyQjtRQUMzQixJQUFJLEtBQUssQ0FBQyxNQUFNLElBQUksQ0FBQyxFQUFFO1lBQ3JCLE9BQU8sS0FBSyxDQUFDO1NBQ2Q7UUFFRCxNQUFNLFlBQVksR0FBRyxDQUFDLEtBQWUsRUFBRSxLQUFxQixFQUFZLEVBQUU7WUFDeEUsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBTSxFQUFFLENBQU0sRUFBRSxFQUFFO2dCQUNuQyxJQUFJLE1BQU0sR0FBUSxDQUFDLENBQUM7Z0JBQ3BCLElBQUksTUFBTSxHQUFRLENBQUMsQ0FBQztnQkFDcEIsTUFBTSxjQUFjLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDM0MsY0FBYyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsRUFBRTtvQkFDakMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztvQkFDM0IsTUFBTSxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztnQkFDN0IsQ0FBQyxDQUFDLENBQUM7Z0JBRUgsSUFBSSxDQUFDLE9BQU8sTUFBTSxLQUFLLFdBQVcsSUFBSSxNQUFNLEtBQUssSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLE1BQU0sS0FBSyxXQUFXLElBQUksTUFBTSxL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QWYsZUFBZTtrQkFIM0IsSUFBSTttQkFBQztvQkFDSixJQUFJLEVBQUUsYUFBYTtpQkFDcEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQaXBlLCBQaXBlVHJhbnNmb3JtIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbkBQaXBlKHtcbiAgbmFtZTogJ2JpenlPcmRlckJ5J1xufSlcbmV4cG9ydCBjbGFzcyBCaXp5T3JkZXJCeVBpcGUgaW1wbGVtZW50cyBQaXBlVHJhbnNmb3JtIHtcbiAgdHJhbnNmb3JtPFQ+KGl0ZW1zOiBBcnJheTxUPiwgb3JkZXI6ICdhc2MnIHwgJ2Rlc2MnIHwgbnVsbCA9IG51bGwsIHByb3BlcnR5OiBzdHJpbmcgPSAnJyk6IEFycmF5PFQ+IHtcbiAgICAvLyBObyBpdGVtc1xuICAgIGlmICghaXRlbXMgfHwgIW9yZGVyKSB7XG4gICAgICByZXR1cm4gaXRlbXM7XG4gICAgfVxuXG4gICAgLy8gQXJyYXkgd2l0aCBvbmx5IG9uZSBpdGVtXG4gICAgaWYgKGl0ZW1zLmxlbmd0aCA8PSAxKSB7XG4gICAgICByZXR1cm4gaXRlbXM7XG4gICAgfVxuXG4gICAgY29uc3Qgc29ydEJ5U3RyaW5nID0gKGl0ZW1zOiBBcnJheTxUPiwgb3JkZXI6ICdhc2MnIHwgJ2Rlc2MnKTogQXJyYXk8VD4gPT4ge1xuICAgICAgcmV0dXJuIGl0ZW1zLnNvcnQoKGE6IGFueSwgYjogYW55KSA9PiB7XG4gICAgICAgIGxldCBhVmFsdWU6IGFueSA9IGE7XG4gICAgICAgIGxldCBiVmFsdWU6IGFueSA9IGI7XG4gICAgICAgIGNvbnN0IG5lc3RlZFByb3BlcnR5ID0gcHJvcGVydHkuc3BsaXQoJy4nKTtcbiAgICAgICAgbmVzdGVkUHJvcGVydHkuZm9yRWFjaChfcHJvcGVydHkgPT4ge1xuICAgICAgICAgIGFWYWx1ZSA9IGFWYWx1ZVtfcHJvcGVydHldO1xuICAgICAgICAgIGJWYWx1ZSA9IGJWYWx1ZVtfcHJvcGVydHldO1xuICAgICAgICB9KTtcbiAgXG4gICAgICAgIGlmICgodHlwZW9mIGFWYWx1ZSA9PT0gJ3VuZGVmaW5lZCcgfHwgYVZhbHVlID09PSBudWxsKSAmJiAodHlwZW9mIGJWYWx1ZSA9PT0gJ3VuZGVmaW5lZCcgfHwgYlZhbHVlID09PSBudWxsKSkge1xuICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gIFxuICAgICAgICBpZiAoKHR5cGVvZiBhVmFsdWUgPT09ICd1bmRlZmluZWQnIHx8IGFWYWx1ZSA9PT0gbnVsbCkgJiYgKHR5cGVvZiBiVmFsdWUgIT09ICd1bmRlZmluZWQnICYmIGJWYWx1ZSAhPT0gbnVsbCkpIHtcbiAgICAgICAgICByZXR1cm4gb3JkZXIgPT09ICdkZXNjJyA/IDEgOiAtMTtcbiAgICAgICAgfVxuICBcbiAgICAgICAgaWYgKCh0eXBlb2YgYVZhbHVlICE9PSAndW5kZWZpbmVkJyAmJiBhVmFsdWUgIT09IG51bGwpICYmICh0eXBlb2YgYlZhbHVlID09PSAndW5kZWZpbmVkJyB8fCBiVmFsdWUgPT09IG51bGwpICkge1xuICAgICAgICAgIHJldHVybiBvcmRlciA9PT0gJ2Rlc2MnID8gLTEgOiAxO1xuICAgICAgICB9XG4gIFxuICAgICAgICBpZiAoYVZhbHVlID09PSBiVmFsdWUpIHtcbiAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICBcbiAgICAgICAgaWYgKG9yZGVyID09PSAnZGVzYycpIHtcbiAgICAgICAgICByZXR1cm4gKHRoaXMuI3JlbW92ZUFjY2VudHNBbmREaWFjcml0aWNzKFN0cmluZyhhVmFsdWUpKS50b0xvd2VyQ2FzZSgpID4gdGhpcy4jcmVtb3ZlQWNjZW50c0FuZERpYWNyaXRpY3MoU3RyaW5nKGJWYWx1ZSkpLnRvTG93ZXJDYXNlKCkgPyAtMSA6IDEpO1xuICAgICAgICB9XG4gIFxuICAgICAgICByZXR1cm4gKHRoaXMuI3JlbW92ZUFjY2VudHNBbmREaWFjcml0aWNzKFN0cmluZyhiVmFsdWUpKS50b0xvd2VyQ2FzZSgpID4gdGhpcy4jcmVtb3ZlQWNjZW50c0FuZERpYWNyaXRpY3MoU3RyaW5nKGFWYWx1ZSkpLnRvTG93ZXJDYXNlKCkgPyAtMSA6IDEpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29uc3Qgc29ydEJ5TnVtYmVyID0gKGl0ZW1zOiBBcnJheTxUPiwgb3JkZXI6ICdhc2MnIHwgJ2Rlc2MnKTogQXJyYXk8VD4gPT4ge1xuICAgICAgaWYgKG9yZGVyID09PSAnYXNjJykge1xuICAgICAgICByZXR1cm4gaXRlbXMuc29ydCgoYSwgYikgPT4gTnVtYmVyKGdldFZhbHVlKGEpKSAtIE51bWJlcihnZXRWYWx1ZShiKSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGl0ZW1zLnNvcnQoKGEsIGIpID0+IE51bWJlcihnZXRWYWx1ZShiKSkgLSBOdW1iZXIoZ2V0VmFsdWUoYSkpKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBzb3J0QnlEYXRlID0gKGl0ZW1zOiBBcnJheTxUPiwgb3JkZXI6ICdhc2MnIHwgJ2Rlc2MnKTogQXJyYXk8VD4gPT4ge1xuICAgICAgcmV0dXJuIGl0ZW1zLnNvcnQoKGEsIGIpID0+ICB7XG4gICAgICAgIGNvbnN0IGFEYXRlID0gcGFyc2VEYXRlU3RyaW5nKGdldFZhbHVlKGEpIGFzIHN0cmluZylcbiAgICAgICAgY29uc3QgYkRhdGUgPSBwYXJzZURhdGVTdHJpbmcoZ2V0VmFsdWUoYikgYXMgc3RyaW5nKVxuICAgICAgICByZXR1cm4gb3JkZXIgPT09ICdhc2MnID8gYURhdGUuZ2V0VGltZSgpIC0gIGJEYXRlLmdldFRpbWUoKSA6IGJEYXRlLmdldFRpbWUoKSAtICBhRGF0ZS5nZXRUaW1lKClcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IGlzRGF0ZSA9ICh2YWx1ZTogc3RyaW5nKSA9PiB7XG4gICAgICBjb25zdCBkZE1NWVlZWWhobW1zcyA9ICAvXlxcZHsxLDJ9XFwvXFxkezEsMn1cXC9cXGR7NH0oIFxcZHsxLDJ9OlxcZHsxLDJ9KDpcXGR7MSwyfSk/KT8kLztcbiAgICAgIHJldHVybiBkZE1NWVlZWWhobW1zcy50ZXN0KHZhbHVlKTtcbiAgICB9XG4gIFxuICAgIGNvbnN0IHBhcnNlRGF0ZVN0cmluZyA9ICh2YWx1ZTogc3RyaW5nKSA9PiB7XG4gICAgICBjb25zdCBbZGF0ZVBhcnQsIHRpbWVQYXJ0XSA9IHZhbHVlLnNwbGl0KCcgJyk7XG4gICAgICBjb25zdCBzZXBhcmF0b3IgPSB2YWx1ZS5pbmNsdWRlcygnLycpID8gJy8nIDogJy0nO1xuICBcbiAgICAgIGNvbnN0IFtkYXksIG1vbnRoLCB5ZWFyXSA9IGRhdGVQYXJ0LnNwbGl0KHNlcGFyYXRvcikubWFwKE51bWJlcik7XG4gIFxuICAgICAgbGV0IGhvdXJzID0gMCwgbWludXRlcyA9IDAsIHNlY29uZHMgPSAwO1xuICBcbiAgICAgIGlmICh0aW1lUGFydCkge1xuICAgICAgICAgIGNvbnN0IFtob3VyU3RyLCBtaW51dGVTdHIsIHNlY29uZFN0cl0gPSB0aW1lUGFydC5zcGxpdCgnOicpLm1hcChOdW1iZXIpO1xuICAgICAgICAgIGhvdXJzID0gaXNOYU4oaG91clN0cikgPyAwIDogaG91clN0cjtcbiAgICAgICAgICBtaW51dGVzID0gaXNOYU4obWludXRlU3RyKSA/IDAgOiBtaW51dGVTdHI7XG4gICAgICAgICAgc2Vjb25kcyA9IGlzTmFOKHNlY29uZFN0cikgPyAwIDogc2Vjb25kU3RyO1xuICAgICAgfVxuICBcbiAgICAgIHJldHVybiBuZXcgRGF0ZSh5ZWFyLCBtb250aCAtIDEsIGRheSwgaG91cnMsIG1pbnV0ZXMsIHNlY29uZHMpO1xuICAgIH1cblxuICAgIGNvbnN0IGdldFZhbHVlID0gKGl0ZW06IFQpID0+IHtcbiAgICAgIGxldCB2YWx1ZSA9IGl0ZW07XG4gICAgICBjb25zdCBuZXN0ZWRQcm9wZXJ0eSA9IHByb3BlcnR5LnNwbGl0KCcuJyk7XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbmVzdGVkUHJvcGVydHkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgcHJvcGVydHkgPSBuZXN0ZWRQcm9wZXJ0eVtpXTtcbiAgICAgICAgaWYgKCFwcm9wZXJ0eSB8fCB0eXBlb2YgdmFsdWVbcHJvcGVydHldID09PSAndW5kZWZpbmVkJyB8fCB2YWx1ZVtwcm9wZXJ0eV0gPT09IG51bGwpIHtcbiAgICAgICAgICB2YWx1ZSA9IG51bGw7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICB2YWx1ZSA9IHZhbHVlW3Byb3BlcnR5XTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cblxuICAgIGxldCBvdXRwdXQ6IEFycmF5PFQ+ID0gWy4uLml0ZW1zXTtcblxuICAgIGlmIChwcm9wZXJ0eSA9PT0gJycpIHtcbiAgICAgIGlmICh0eXBlb2Ygb3V0cHV0WzBdID09PSAnbnVtYmVyJyAmJiAhaXNOYU4ob3V0cHV0WzBdKSkge1xuICAgICAgICByZXR1cm4gc29ydEJ5TnVtYmVyKG91dHB1dCwgb3JkZXIpO1xuICAgICAgfSBlbHNlIGlmIChpc0RhdGUob3V0cHV0WzBdIGFzIHN0cmluZykpIHtcbiAgICAgICAgcmV0dXJuIHNvcnRCeURhdGUob3V0cHV0LCBvcmRlcik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gc29ydEJ5U3RyaW5nKG91dHB1dCwgb3JkZXIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGluZGV4ID0gb3V0cHV0LmZpbmRJbmRleChfaXRlbSA9PiB7XG4gICAgICBjb25zdCB2YWx1ZSA9IGdldFZhbHVlKF9pdGVtKTtcbiAgICAgIHJldHVybiB0eXBlb2YgdmFsdWUgIT09ICd1bmRlZmluZWQnICYmIHZhbHVlICE9PSBudWxsO1xuICAgIH0pO1xuXG4gICAgaWYgKGluZGV4ID09PSAtMSkge1xuICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICB9XG5cblxuICAgIGNvbnN0IHZhbHVlID0gZ2V0VmFsdWUob3V0cHV0W2luZGV4XSk7XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgJiYgIWlzTmFOKHZhbHVlKSkge1xuICAgICAgcmV0dXJuIHNvcnRCeU51bWJlcihvdXRwdXQsIG9yZGVyKTtcbiAgICB9IGVsc2UgaWYgKGlzRGF0ZSh2YWx1ZSBhcyBzdHJpbmcpKSB7XG4gICAgICByZXR1cm4gc29ydEJ5RGF0ZShvdXRwdXQsIG9yZGVyKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHNvcnRCeVN0cmluZyhvdXRwdXQsIG9yZGVyKTtcbiAgICB9XG4gIH1cblxuICAjcmVtb3ZlQWNjZW50c0FuZERpYWNyaXRpY3Moc2VhcmNoOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGlmICghc2VhcmNoKSB7XG4gICAgICByZXR1cm4gJyc7XG4gICAgfVxuXG4gICAgcmV0dXJuIHNlYXJjaC5ub3JtYWxpemUoJ05GRCcpIS5yZXBsYWNlKC9bXFx1MDMwMC1cXHUwMzZmXS9nLCAnJyk7XG4gIH1cbn1cbiJdfQ==