import Uppy from '@uppy/core';
import { Subject } from 'rxjs';
import { Injectable, Renderer2, inject } from '@angular/core';
import es_ES from '@uppy/locales/lib/es_ES';
import en_US from '@uppy/locales/lib/en_US';
import Dashboard from '@uppy/dashboard';
import XHRUpload from '@uppy/xhr-upload';
import { DOCUMENT } from '@angular/common';
import * as i0 from "@angular/core";
const ES = {
    ...es_ES,
    strings: {
        ...es_ES.strings,
        noDuplicates: 'Archivo duplicado: \'%{fileName}\'',
        browseFiles: 'buscar archivo',
        dropPasteFiles: 'Soltar archivo aquí, pegar o %{browse}'
    }
};
const EN = {
    ...en_US,
    strings: {
        ...en_US.strings,
        noDuplicates: 'Duplicated file: \'%{fileName}\'',
        browseFiles: 'browse file',
        dropPasteFiles: 'Drop a file here or %{browse}'
    }
};
export class BizyFileUploaderService {
    #renderer = inject(Renderer2);
    #document = inject(DOCUMENT);
    #fileLoaded = new Subject();
    #fileRemoved = new Subject();
    #upload = new Subject();
    #uploadSuccess = new Subject();
    #error = new Subject();
    #cancelAll = new Subject();
    #complete = new Subject();
    #disableLocalFiles = false;
    #uppy = null;
    get fileLoaded$() {
        return this.#fileLoaded.asObservable();
    }
    get fileRemoved$() {
        return this.#fileRemoved.asObservable();
    }
    get upload$() {
        return this.#upload.asObservable();
    }
    get uploadSuccess$() {
        return this.#uploadSuccess.asObservable();
    }
    get error$() {
        return this.#error.asObservable();
    }
    get cancelAll$() {
        return this.#cancelAll.asObservable();
    }
    get complete$() {
        return this.#complete.asObservable();
    }
    createFileUploader(data) {
        const locale = data.language === 'es' ? ES : EN;
        this.#disableLocalFiles = data.disableLocalFiles;
        this.#uppy = new Uppy({
            locale,
            infoTimeout: 2500,
            restrictions: {
                maxFileSize: data.maxFileSize,
                minFileSize: data.minFileSize,
                maxTotalFileSize: data.maxTotalFileSize,
                maxNumberOfFiles: data.maxNumberOfFiles,
                minNumberOfFiles: data.minNumberOfFiles,
                allowedFileTypes: data.allowedFileTypes
            }
        })
            .use(Dashboard, {
            inline: true,
            singleFileFullScreen: false,
            target: `#${data.templateId}`,
            width: data.dragDropAreaWidth,
            height: data.dragDropAreaHeight,
            hideCancelButton: data.hideCancelButton,
            hideUploadButton: data.hideUploadButton,
            hidePauseResumeButton: data.hidePauseResumeButton,
            disableLocalFiles: data.disableLocalFiles
        })
            .use(XHRUpload, {
            endpoint: '',
            headers: data.headers,
            getResponseData: (responseText, response) => {
                return {
                    fileId: responseText,
                    response
                };
            }
        })
            .on('file-added', file => {
            this.#removeUnnecessaryOptions(this.#disableLocalFiles);
            this.#fileLoaded.next(file);
        })
            .on('file-removed', file => {
            this.#removeUnnecessaryOptions(this.#disableLocalFiles);
            this.#fileRemoved.next(file);
        })
            .on('upload', data => {
            this.#upload.next();
        })
            .on('upload-success', (file, response) => {
            if (file) {
                this.#uploadSuccess.next({ file, response });
            }
        })
            .on('upload-error', (file, error, response) => {
            this.#error.next({ file, error, response });
        })
            .on('restriction-failed', (file, error) => {
            this.#error.next({ file, error });
        })
            .on('error', error => {
            this.#error.next({ error });
        })
            .on('cancel-all', () => {
            this.#cancelAll.next();
        })
            .on('complete', result => {
            this.#removeUnnecessaryOptions(this.#disableLocalFiles);
            this.#complete.next(result);
        });
        this.#removeUnnecessaryOptions(this.#disableLocalFiles);
    }
    load = (data) => {
        if (!this.#uppy) {
            return;
        }
        this.#uppy.addFile({
            name: data.file.name,
            type: data.file.type,
            data: data.file,
            meta: {
                // Optional, store the directory path of a file so Uppy can tell identical files in different directories apart.
                relativePath: data.file.webkitRelativePath,
                referenceId: data.id
            },
            source: 'Local',
            isRemote: false // Optional, set to true if actual file is not in the browser, but on some remote server, for example,
            // when using companion in combination with Instagram.
        });
    };
    disable(value) {
        if (!this.#uppy) {
            return;
        }
        const dashboard = this.#uppy.getPlugin('Dashboard');
        dashboard.setOptions({ disabled: value });
    }
    upload = (data) => {
        if (!this.#uppy) {
            return;
        }
        this.#uppy.getPlugin('XHRUpload').setOptions({
            endpoint: data.endpoint,
            headers: data.headers ?? {}
        });
        this.#uppy.upload();
    };
    cleanAllFiles = () => {
        if (!this.#uppy) {
            return;
        }
        this.#uppy.cancelAll();
    };
    #removeUnnecessaryOptions = (remove) => {
        setTimeout(() => {
            if (!remove) {
                return;
            }
            const browseButton = this.#document.getElementsByClassName('uppy-Dashboard-browse')[0];
            if (browseButton) {
                this.#renderer.setStyle(browseButton, 'display', 'none');
            }
            const dragAndDropText = this.#document.getElementsByClassName('uppy-Dashboard-AddFiles-title')[0];
            if (dragAndDropText) {
                this.#renderer.setStyle(dragAndDropText, 'display', 'none');
            }
            const addMoreFilesButton = this.#document.getElementsByClassName('uppy-DashboardContent-addMore')[0];
            if (addMoreFilesButton) {
                this.#renderer.setStyle(addMoreFilesButton, 'display', 'none');
            }
            const doneButton = this.#document.getElementsByClassName('uppy-StatusBar-actionBtn--done')[0];
            if (doneButton) {
                this.#renderer.setStyle(doneButton, 'display', 'none');
            }
        }, 0);
    };
    static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: BizyFileUploaderService, deps: [], target: i0.ɵɵFactoryTarget.Injectable });
    static ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: BizyFileUploaderService });
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: BizyFileUploaderService, decorators: [{
            type: Injectable
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZS11cGxvYWRlci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvY29tcG9uZW50cy9zcmMvbGliL2ZpbGUtdXBsb2FkZXIvZmlsZS11cGxvYWRlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sSUFBa0QsTUFBTSxZQUFZLENBQUM7QUFDNUUsT0FBTyxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMzQyxPQUFPLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDOUQsT0FBTyxLQUFLLE1BQU0seUJBQXlCLENBQUM7QUFDNUMsT0FBTyxLQUFLLE1BQU0seUJBQXlCLENBQUM7QUFDNUMsT0FBTyxTQUFTLE1BQU0saUJBQWlCLENBQUM7QUFDeEMsT0FBTyxTQUFTLE1BQU0sa0JBQWtCLENBQUM7QUFDekMsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDOztBQUUzQyxNQUFNLEVBQUUsR0FBRztJQUNULEdBQUcsS0FBSztJQUNSLE9BQU8sRUFBRTtRQUNQLEdBQUcsS0FBSyxDQUFDLE9BQU87UUFDaEIsWUFBWSxFQUFFLG9DQUFvQztRQUNsRCxXQUFXLEVBQUUsZ0JBQWdCO1FBQzdCLGNBQWMsRUFBRSx3Q0FBd0M7S0FFekQ7Q0FDRixDQUFDO0FBRUYsTUFBTSxFQUFFLEdBQUc7SUFDVCxHQUFHLEtBQUs7SUFDUixPQUFPLEVBQUU7UUFDUCxHQUFHLEtBQUssQ0FBQyxPQUFPO1FBQ2hCLFlBQVksRUFBRSxrQ0FBa0M7UUFDaEQsV0FBVyxFQUFFLGFBQWE7UUFDMUIsY0FBYyxFQUFFLCtCQUErQjtLQUNoRDtDQUNGLENBQUM7QUFHRixNQUFNLE9BQU8sdUJBQXVCO0lBQ2xDLFNBQVMsR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDOUIsU0FBUyxHQUFHLE1BQU0sQ0FB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QUFNLENBQUMsQ0FBQzthQUMxRDtZQUVELE1BQU0sZUFBZSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsc0JBQXNCLENBQUMsK0JBQStCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNsRyxJQUFJLGVBQWUsRUFBRTtnQkFDbkIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsZUFBZSxFQUFFLFNBQVMsRUFBRSxNQUFNLENBQUMsQ0FBQzthQUM3RDtZQUVELE1BQU0sa0JBQWtCLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxzQkFBc0IsQ0FDOUQsK0JBQStCLENBQ2hDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDTCxJQUFJLGtCQUFrQixFQUFFO2dCQUN0QixJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxrQkFBa0IsRUFBRSxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUM7YUFDaEU7WUFFRCxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLHNCQUFzQixDQUFDLGdDQUFnQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDOUYsSUFBSSxVQUFVLEVBQUU7Z0JBQ2QsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsVUFBVSxFQUFFLFNBQVMsRUFBRSxNQUFNLENBQUMsQ0FBQzthQUN4RDtRQUNILENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUNSLENBQUMsQ0FBQTt3R0EvTVUsdUJBQXVCOzRHQUF2Qix1QkFBdUI7OzRGQUF2Qix1QkFBdUI7a0JBRG5DLFVBQVUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgVXBweSwgeyBFcnJvclJlc3BvbnNlLCBTdWNjZXNzUmVzcG9uc2UsIFVwcHlGaWxlIH0gZnJvbSAnQHVwcHkvY29yZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBJbmplY3RhYmxlLCBSZW5kZXJlcjIsIGluamVjdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IGVzX0VTIGZyb20gJ0B1cHB5L2xvY2FsZXMvbGliL2VzX0VTJztcbmltcG9ydCBlbl9VUyBmcm9tICdAdXBweS9sb2NhbGVzL2xpYi9lbl9VUyc7XG5pbXBvcnQgRGFzaGJvYXJkIGZyb20gJ0B1cHB5L2Rhc2hib2FyZCc7XG5pbXBvcnQgWEhSVXBsb2FkIGZyb20gJ0B1cHB5L3hoci11cGxvYWQnO1xuaW1wb3J0IHsgRE9DVU1FTlQgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuXG5jb25zdCBFUyA9IHsgXG4gIC4uLmVzX0VTLFxuICBzdHJpbmdzOiB7XG4gICAgLi4uZXNfRVMuc3RyaW5ncyxcbiAgICBub0R1cGxpY2F0ZXM6ICdBcmNoaXZvIGR1cGxpY2FkbzogXFwnJXtmaWxlTmFtZX1cXCcnLFxuICAgIGJyb3dzZUZpbGVzOiAnYnVzY2FyIGFyY2hpdm8nLFxuICAgIGRyb3BQYXN0ZUZpbGVzOiAnU29sdGFyIGFyY2hpdm8gYXF1w60sIHBlZ2FyIG8gJXticm93c2V9J1xuXG4gIH1cbn07XG5cbmNvbnN0IEVOID0geyBcbiAgLi4uZW5fVVMsXG4gIHN0cmluZ3M6IHtcbiAgICAuLi5lbl9VUy5zdHJpbmdzLFxuICAgIG5vRHVwbGljYXRlczogJ0R1cGxpY2F0ZWQgZmlsZTogXFwnJXtmaWxlTmFtZX1cXCcnLFxuICAgIGJyb3dzZUZpbGVzOiAnYnJvd3NlIGZpbGUnLFxuICAgIGRyb3BQYXN0ZUZpbGVzOiAnRHJvcCBhIGZpbGUgaGVyZSBvciAle2Jyb3dzZX0nXG4gIH1cbn07XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBCaXp5RmlsZVVwbG9hZGVyU2VydmljZSB7XG4gICNyZW5kZXJlciA9IGluamVjdChSZW5kZXJlcjIpO1xuICAjZG9jdW1lbnQgPSBpbmplY3QoRE9DVU1FTlQpO1xuICAjZmlsZUxvYWRlZCA9IG5ldyBTdWJqZWN0PFVwcHlGaWxlPigpO1xuICAjZmlsZVJlbW92ZWQgPSBuZXcgU3ViamVjdDxVcHB5RmlsZT4oKTtcbiAgI3VwbG9hZCA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG4gICN1cGxvYWRTdWNjZXNzID0gbmV3IFN1YmplY3Q8e2ZpbGU6IFVwcHlGaWxlLCByZXNwb25zZTogU3VjY2Vzc1Jlc3BvbnNlfT4oKTtcbiAgI2Vycm9yID0gbmV3IFN1YmplY3Q8eyBmaWxlPzogVXBweUZpbGU7IGVycm9yOiBFcnJvciwgcmVzcG9uc2U/OiBFcnJvclJlc3BvbnNlIH0+KCk7XG4gICNjYW5jZWxBbGwgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuICAjY29tcGxldGUgPSBuZXcgU3ViamVjdDx7IHN1Y2Nlc3NmdWw6IEFycmF5PFVwcHlGaWxlPjsgZmFpbGVkOiBBcnJheTxVcHB5RmlsZT4gfT4oKTtcbiAgI2Rpc2FibGVMb2NhbEZpbGVzOiBib29sZWFuID0gZmFsc2U7XG5cbiAgI3VwcHk6IFVwcHkgfCBudWxsID0gbnVsbDtcblxuICBnZXQgZmlsZUxvYWRlZCQoKTogT2JzZXJ2YWJsZTxVcHB5RmlsZT4ge1xuICAgIHJldHVybiB0aGlzLiNmaWxlTG9hZGVkLmFzT2JzZXJ2YWJsZSgpO1xuICB9XG5cbiAgZ2V0IGZpbGVSZW1vdmVkJCgpOiBPYnNlcnZhYmxlPFVwcHlGaWxlPiB7XG4gICAgcmV0dXJuIHRoaXMuI2ZpbGVSZW1vdmVkLmFzT2JzZXJ2YWJsZSgpO1xuICB9XG5cbiAgZ2V0IHVwbG9hZCQoKTogT2JzZXJ2YWJsZTx2b2lkPiB7XG4gICAgcmV0dXJuIHRoaXMuI3VwbG9hZC5hc09ic2VydmFibGUoKTtcbiAgfVxuXG4gIGdldCB1cGxvYWRTdWNjZXNzJCgpOiBPYnNlcnZhYmxlPHtmaWxlOiBVcHB5RmlsZSwgcmVzcG9uc2U6IFN1Y2Nlc3NSZXNwb25zZX0+IHtcbiAgICByZXR1cm4gdGhpcy4jdXBsb2FkU3VjY2Vzcy5hc09ic2VydmFibGUoKTtcbiAgfVxuXG4gIGdldCBlcnJvciQoKTogT2JzZXJ2YWJsZTx7IGZpbGU/OiBVcHB5RmlsZTsgZXJyb3I6IEVycm9yIH0+IHtcbiAgICByZXR1cm4gdGhpcy4jZXJyb3IuYXNPYnNlcnZhYmxlKCk7XG4gIH1cblxuICBnZXQgY2FuY2VsQWxsJCgpOiBPYnNlcnZhYmxlPHZvaWQ+IHtcbiAgICByZXR1cm4gdGhpcy4jY2FuY2VsQWxsLmFzT2JzZXJ2YWJsZSgpO1xuICB9XG5cbiAgZ2V0IGNvbXBsZXRlJCgpOiBPYnNlcnZhYmxlPHsgc3VjY2Vzc2Z1bDogQXJyYXk8VXBweUZpbGU+OyBmYWlsZWQ6IEFycmF5PFVwcHlGaWxlPiB9PiB7XG4gICAgcmV0dXJuIHRoaXMuI2NvbXBsZXRlLmFzT2JzZXJ2YWJsZSgpO1xuICB9XG5cbiAgY3JlYXRlRmlsZVVwbG9hZGVyKGRhdGE6IHtcbiAgICAgIG1heEZpbGVTaXplOiBudW1iZXIgfCBudWxsO1xuICAgICAgbWluRmlsZVNpemU6IG51bWJlciB8IG51bGw7XG4gICAgICBtYXhUb3RhbEZpbGVTaXplOiBudW1iZXIgfCBudWxsO1xuICAgICAgbWF4TnVtYmVyT2ZGaWxlczogbnVtYmVyIHwgbnVsbDtcbiAgICAgIG1pbk51bWJlck9mRmlsZXM6IG51bWJlciB8IG51bGw7XG4gICAgICBkcmFnRHJvcEFyZWFXaWR0aDogc3RyaW5nO1xuICAgICAgZHJhZ0Ryb3BBcmVhSGVpZ2h0OiBzdHJpbmc7XG4gICAgICBhbGxvd2VkRmlsZVR5cGVzOiBBcnJheTxzdHJpbmc+O1xuICAgICAgbGFuZ3VhZ2U6ICdlcycgfCAnZW4nO1xuICAgICAgdGVtcGxhdGVJZDogc3RyaW5nO1xuICAgICAgaGlkZUNhbmNlbEJ1dHRvbjogYm9vbGVhbixcbiAgICAgIGhpZGVVcGxvYWRCdXR0b246IGJvb2xlYW4sXG4gICAgICBoaWRlUGF1c2VSZXN1bWVCdXR0b246IGJvb2xlYW4sXG4gICAgICBkaXNhYmxlTG9jYWxGaWxlczogYm9vbGVhbixcbiAgICAgIGhlYWRlcnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XG4gIH0pOiB2b2lkIHtcbiAgICBjb25zdCBsb2NhbGUgPSBkYXRhLmxhbmd1YWdlID09PSAnZXMnID8gRVMgOiBFTjtcbiAgICB0aGlzLiNkaXNhYmxlTG9jYWxGaWxlcyA9IGRhdGEuZGlzYWJsZUxvY2FsRmlsZXM7XG4gICAgdGhpcy4jdXBweSA9IG5ldyBVcHB5KHtcbiAgICAgIGxvY2FsZSxcbiAgICAgIGluZm9UaW1lb3V0OiAyNTAwLFxuICAgICAgcmVzdHJpY3Rpb25zOiB7XG4gICAgICAgIG1heEZpbGVTaXplOiBkYXRhLm1heEZpbGVTaXplLFxuICAgICAgICBtaW5GaWxlU2l6ZTogZGF0YS5taW5GaWxlU2l6ZSxcbiAgICAgICAgbWF4VG90YWxGaWxlU2l6ZTogZGF0YS5tYXhUb3RhbEZpbGVTaXplLFxuICAgICAgICBtYXhOdW1iZXJPZkZpbGVzOiBkYXRhLm1heE51bWJlck9mRmlsZXMsXG4gICAgICAgIG1pbk51bWJlck9mRmlsZXM6IGRhdGEubWluTnVtYmVyT2ZGaWxlcyxcbiAgICAgICAgYWxsb3dlZEZpbGVUeXBlczogZGF0YS5hbGxvd2VkRmlsZVR5cGVzXG4gICAgICB9XG4gICAgfSlcbiAgICAgIC51c2UoRGFzaGJvYXJkLCB7XG4gICAgICAgIGlubGluZTogdHJ1ZSxcbiAgICAgICAgc2luZ2xlRmlsZUZ1bGxTY3JlZW46IGZhbHNlLFxuICAgICAgICB0YXJnZXQ6IGAjJHtkYXRhLnRlbXBsYXRlSWR9YCxcbiAgICAgICAgd2lkdGg6IGRhdGEuZHJhZ0Ryb3BBcmVhV2lkdGgsXG4gICAgICAgIGhlaWdodDogZGF0YS5kcmFnRHJvcEFyZWFIZWlnaHQsXG4gICAgICAgIGhpZGVDYW5jZWxCdXR0b246IGRhdGEuaGlkZUNhbmNlbEJ1dHRvbixcbiAgICAgICAgaGlkZVVwbG9hZEJ1dHRvbjogZGF0YS5oaWRlVXBsb2FkQnV0dG9uLFxuICAgICAgICBoaWRlUGF1c2VSZXN1bWVCdXR0b246IGRhdGEuaGlkZVBhdXNlUmVzdW1lQnV0dG9uLFxuICAgICAgICBkaXNhYmxlTG9jYWxGaWxlczogZGF0YS5kaXNhYmxlTG9jYWxGaWxlc1xuICAgICAgfSlcbiAgICAgIC51c2UoWEhSVXBsb2FkLCB7XG4gICAgICAgIGVuZHBvaW50OiAnJyxcbiAgICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzLFxuICAgICAgICBnZXRSZXNwb25zZURhdGE6IChyZXNwb25zZVRleHQsIHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGZpbGVJZDogcmVzcG9uc2VUZXh0LFxuICAgICAgICAgICAgcmVzcG9uc2VcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLm9uKCdmaWxlLWFkZGVkJywgZmlsZSA9PiB7XG4gICAgICAgIHRoaXMuI3JlbW92ZVVubmVjZXNzYXJ5T3B0aW9ucyh0aGlzLiNkaXNhYmxlTG9jYWxGaWxlcyk7XG4gICAgICAgIHRoaXMuI2ZpbGVMb2FkZWQubmV4dChmaWxlKTtcbiAgICAgIH0pXG4gICAgICAub24oJ2ZpbGUtcmVtb3ZlZCcsIGZpbGUgPT4ge1xuICAgICAgICB0aGlzLiNyZW1vdmVVbm5lY2Vzc2FyeU9wdGlvbnModGhpcy4jZGlzYWJsZUxvY2FsRmlsZXMpO1xuICAgICAgICB0aGlzLiNmaWxlUmVtb3ZlZC5uZXh0KGZpbGUpO1xuICAgICAgfSlcbiAgICAgIC5vbigndXBsb2FkJywgZGF0YSA9PiB7XG4gICAgICAgIHRoaXMuI3VwbG9hZC5uZXh0KCk7XG4gICAgICB9KVxuICAgICAgLm9uKCd1cGxvYWQtc3VjY2VzcycsIChmaWxlLCByZXNwb25zZSkgPT4ge1xuICAgICAgICBpZiAoZmlsZSkge1xuICAgICAgICAgIHRoaXMuI3VwbG9hZFN1Y2Nlc3MubmV4dCh7ZmlsZSwgcmVzcG9uc2V9KTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC5vbigndXBsb2FkLWVycm9yJywgKGZpbGUsIGVycm9yLCByZXNwb25zZSkgPT4ge1xuICAgICAgICB0aGlzLiNlcnJvci5uZXh0KHsgZmlsZSwgZXJyb3IsIHJlc3BvbnNlIH0pO1xuICAgICAgfSlcbiAgICAgIC5vbigncmVzdHJpY3Rpb24tZmFpbGVkJywgKGZpbGUsIGVycm9yKSA9PiB7XG4gICAgICAgIHRoaXMuI2Vycm9yLm5leHQoeyBmaWxlLCBlcnJvciB9KTtcbiAgICAgIH0pXG4gICAgICAub24oJ2Vycm9yJywgZXJyb3IgPT4ge1xuICAgICAgICB0aGlzLiNlcnJvci5uZXh0KHsgZXJyb3IgfSk7XG4gICAgICB9KVxuICAgICAgLm9uKCdjYW5jZWwtYWxsJywgKCkgPT4ge1xuICAgICAgICB0aGlzLiNjYW5jZWxBbGwubmV4dCgpO1xuICAgICAgfSlcbiAgICAgIC5vbignY29tcGxldGUnLCByZXN1bHQgPT4ge1xuICAgICAgICB0aGlzLiNyZW1vdmVVbm5lY2Vzc2FyeU9wdGlvbnModGhpcy4jZGlzYWJsZUxvY2FsRmlsZXMpO1xuICAgICAgICB0aGlzLiNjb21wbGV0ZS5uZXh0KHJlc3VsdCk7XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgdGhpcy4jcmVtb3ZlVW5uZWNlc3NhcnlPcHRpb25zKHRoaXMuI2Rpc2FibGVMb2NhbEZpbGVzKTtcbiAgfVxuXG4gIGxvYWQgPSAoZGF0YTogeyBpZDogc3RyaW5nOyBmaWxlOiBGaWxlIH0pOiB2b2lkID0+IHtcbiAgICBpZiAoIXRoaXMuI3VwcHkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLiN1cHB5LmFkZEZpbGUoe1xuICAgICAgbmFtZTogZGF0YS5maWxlLm5hbWUsIC8vIEZpbGUgbmFtZVxuICAgICAgdHlwZTogZGF0YS5maWxlLnR5cGUsIC8vIEZpbGUgdHlwZVxuICAgICAgZGF0YTogZGF0YS5maWxlLCAvLyBGaWxlIGJsb2JcbiAgICAgIG1ldGE6IHtcbiAgICAgICAgLy8gT3B0aW9uYWwsIHN0b3JlIHRoZSBkaXJlY3RvcnkgcGF0aCBvZiBhIGZpbGUgc28gVXBweSBjYW4gdGVsbCBpZGVudGljYWwgZmlsZXMgaW4gZGlmZmVyZW50IGRpcmVjdG9yaWVzIGFwYXJ0LlxuICAgICAgICByZWxhdGl2ZVBhdGg6IGRhdGEuZmlsZS53ZWJraXRSZWxhdGl2ZVBhdGgsXG4gICAgICAgIHJlZmVyZW5jZUlkOiBkYXRhLmlkXG4gICAgICB9LFxuICAgICAgc291cmNlOiAnTG9jYWwnLCAvLyBPcHRpb25hbCwgZGV0ZXJtaW5lcyB0aGUgc291cmNlIG9mIHRoZSBmaWxlLCBmb3IgZXhhbXBsZSwgSW5zdGFncmFtLlxuICAgICAgaXNSZW1vdGU6IGZhbHNlIC8vIE9wdGlvbmFsLCBzZXQgdG8gdHJ1ZSBpZiBhY3R1YWwgZmlsZSBpcyBub3QgaW4gdGhlIGJyb3dzZXIsIGJ1dCBvbiBzb21lIHJlbW90ZSBzZXJ2ZXIsIGZvciBleGFtcGxlLFxuICAgICAgLy8gd2hlbiB1c2luZyBjb21wYW5pb24gaW4gY29tYmluYXRpb24gd2l0aCBJbnN0YWdyYW0uXG4gICAgfSk7XG4gIH1cblxuICBkaXNhYmxlKHZhbHVlOiBib29sZWFuKSB7XG4gICAgaWYgKCF0aGlzLiN1cHB5KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgZGFzaGJvYXJkID0gdGhpcy4jdXBweS5nZXRQbHVnaW4oJ0Rhc2hib2FyZCcpO1xuICAgIGRhc2hib2FyZC5zZXRPcHRpb25zKHsgZGlzYWJsZWQ6IHZhbHVlIH0pO1xuICB9XG5cbiAgdXBsb2FkID0gKGRhdGE6IHtlbmRwb2ludDogc3RyaW5nLCBoZWFkZXJzPzogUmVjb3JkPHN0cmluZyxzdHJpbmc+fSkgPT4ge1xuICAgIGlmICghdGhpcy4jdXBweSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuI3VwcHkuZ2V0UGx1Z2luKCdYSFJVcGxvYWQnKSEuc2V0T3B0aW9ucyh7XG4gICAgICBlbmRwb2ludDogZGF0YS5lbmRwb2ludCxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVycyA/PyB7fVxuICAgIH0pO1xuICAgIHRoaXMuI3VwcHkudXBsb2FkKCk7XG4gIH1cblxuICBjbGVhbkFsbEZpbGVzID0gKCkgPT4ge1xuICAgIGlmICghdGhpcy4jdXBweSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuI3VwcHkuY2FuY2VsQWxsKCk7XG4gIH1cblxuICAjcmVtb3ZlVW5uZWNlc3NhcnlPcHRpb25zID0gKHJlbW92ZTogYm9vbGVhbikgPT4ge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgaWYgKCFyZW1vdmUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBicm93c2VCdXR0b24gPSB0aGlzLiNkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCd1cHB5LURhc2hib2FyZC1icm93c2UnKVswXTtcbiAgICAgIGlmIChicm93c2VCdXR0b24pIHtcbiAgICAgICAgdGhpcy4jcmVuZGVyZXIuc2V0U3R5bGUoYnJvd3NlQnV0dG9uLCAnZGlzcGxheScsICdub25lJyk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGRyYWdBbmREcm9wVGV4dCA9IHRoaXMuI2RvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3VwcHktRGFzaGJvYXJkLUFkZEZpbGVzLXRpdGxlJylbMF07XG4gICAgICBpZiAoZHJhZ0FuZERyb3BUZXh0KSB7XG4gICAgICAgIHRoaXMuI3JlbmRlcmVyLnNldFN0eWxlKGRyYWdBbmREcm9wVGV4dCwgJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBhZGRNb3JlRmlsZXNCdXR0b24gPSB0aGlzLiNkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFxuICAgICAgICAndXBweS1EYXNoYm9hcmRDb250ZW50LWFkZE1vcmUnXG4gICAgICApWzBdO1xuICAgICAgaWYgKGFkZE1vcmVGaWxlc0J1dHRvbikge1xuICAgICAgICB0aGlzLiNyZW5kZXJlci5zZXRTdHlsZShhZGRNb3JlRmlsZXNCdXR0b24sICdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZG9uZUJ1dHRvbiA9IHRoaXMuI2RvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3VwcHktU3RhdHVzQmFyLWFjdGlvbkJ0bi0tZG9uZScpWzBdO1xuICAgICAgaWYgKGRvbmVCdXR0b24pIHtcbiAgICAgICAgdGhpcy4jcmVuZGVyZXIuc2V0U3R5bGUoZG9uZUJ1dHRvbiwgJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgfVxuICAgIH0sIDApO1xuICB9XG59XG4iXX0=